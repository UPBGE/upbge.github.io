!function(){"use strict";var t;class e{constructor(t){this.isOpen=!1,this.type="version-popover"===t,this.btn=document.querySelector("#"+t),this.dialog=this.btn.nextElementSibling,this.list=this.dialog.querySelector("ul"),this.sel=null;const e=this;this.btnClickHandler=function(t){e.init(),t.preventDefault(),t.stopPropagation()},this.btnKeyHandler=function(t){e.btnKeyFilter(t)&&(e.init(),t.preventDefault(),t.stopPropagation())},this.btn.addEventListener("click",this.btnClickHandler),this.btn.addEventListener("keydown",this.btnKeyHandler)}init(){this.btn.removeEventListener("click",this.btnClickHandler),this.btn.removeEventListener("keydown",this.btnKeyHandler),new Promise(((e,i)=>{void 0===t?(this.btn.classList.add("wait"),fetch("https://docs.blender.org/PROD/versions.json").then((t=>t.json())).then((i=>{t=i,e()})).catch((()=>{console.error("Version Switch Error: versions.json could not be loaded."),this.btn.classList.remove("disabled")}))):e()})).then((()=>{let e=DOCUMENTATION_OPTIONS.VERSION;const i=e.match(/\d\.\d+/g);i&&(e=i[0]),this.warnOld(e,t);const n=this.getNamed(e);this.buildList(n),this.list.firstElementChild.remove();const s=this;this.list.addEventListener("keydown",(function(t){s.keyMove(t)})),this.btn.classList.remove("wait"),this.btnOpenHandler(),this.btn.addEventListener("mousedown",(function(t){s.btnOpenHandler(),t.preventDefault()})),this.btn.addEventListener("keydown",(function(t){s.btnKeyFilter(t)&&s.btnOpenHandler()}))}))}warnOld(t,e){let i=e.current;if(!i)return;const n=i.match(/\d\.\d+/g);if(n&&(i=parseFloat(n[0])),t<i){const e=window.location.pathname.replace(t,i),n=document.querySelector("template#version-warning").firstElementChild.cloneNode(!0),s=n.querySelector("a");s.setAttribute("href",e),s.textContent=i;let r=document.querySelector("div.body");r.length||(r=document.querySelector("div.document")),r.prepend(n)}}buildList(e){const i=new URL(window.location.href);let n,s,r=["","api",e];i.pathname.startsWith("/api/")?r.push(i.pathname.split("/").slice(4).join("/")):r.push(i.pathname.substring(1)),this.type&&(n=t,s=e);const o=this,l=document.querySelector("template#version-entry").content;for(let[t,e]of Object.entries(n)){let n;if(t===s)n=l.querySelector("li.selected").cloneNode(!0),n.querySelector("span").innerHTML=e;else{r[1+o.type]=t;let s=new URL(i);s.pathname=r.join("/"),n=l.firstElementChild.cloneNode(!0);const a=n.querySelector("a");a.href=s,a.innerHTML=e}o.list.append(n)}return this.list}getNamed(e){for(let[i,n]of Object.entries(t))if("master"===i||"main"===i||"latest"===i){const t=n.match(/\d\.\d[\w\d\.]*/)[0];if(parseFloat(t)==e)return e=i,!1}return e}dialogToggle(t){const e=!this.isOpen,i=this;if(this.isOpen?(this.btn.classList.remove("version-btn-open"),this.btn.setAttribute("aria-pressed",!1),this.dialog.setAttribute("aria-hidden",!0),this.btn.parentNode.removeEventListener("focusout",this.focusoutHandlerPrime),this.btn.parentNode.removeEventListener("mouseleave",this.mouseoutHandlerPrime),this.dialog.animate({opacity:[1,0],easing:["ease-in","ease-out"]},t).finished.then((()=>{this.dialog.style.display="none",this.sel&&this.sel.setAttribute("tabindex",-1),this.btn.setAttribute("tabindex",0),null!==document.activeElement&&document.activeElement!==document&&document.activeElement!==document.body&&this.btn.focus()})),this.isOpen=!1):(this.btn.classList.add("version-btn-open"),this.btn.setAttribute("aria-pressed",!0),this.dialog.setAttribute("aria-hidden",!1),this.dialog.style.display="block",this.dialog.animate({opacity:[0,1],easing:["ease-in","ease-out"]},t).finished.then((()=>{this.focusoutHandlerPrime=function(t){i.focusoutHandler(),t.stopImmediatePropagation()},this.mouseoutHandlerPrime=function(t){i.mouseoutHandler(),t.stopImmediatePropagation()},this.btn.parentNode.addEventListener("focusout",this.focusoutHandlerPrime),this.btn.parentNode.addEventListener("mouseleave",this.mouseoutHandlerPrime)})),this.isOpen=!0),e&&(this.sel&&this.sel.setAttribute("tabindex",-1),null!==document.activeElement&&document.activeElement!==document&&document.activeElement!==document.body)){const t=this.listEnter();t.setAttribute("tabindex",0),t.focus(),this.sel=t}}btnOpenHandler(){this.dialogToggle(300)}focusoutHandler(){const t=this.list,e=this;setTimeout((function(){t.querySelector(":focus")||e.dialogToggle(200)}),200)}mouseoutHandler(){this.dialogToggle(200)}btnKeyFilter(t){return!t.ctrlKey&&!t.shiftKey&&!!(" "===t.key||"Enter"===t.key||"ArrowDown"===t.key&&t.altKey||"ArrowDown"===t.key||"ArrowUp"===t.key)}keyMove(t){if(t.ctrlKey||t.shiftKey)return!0;let e=t.target;switch(t.key){case"ArrowUp":e=this.listPrev(e);break;case"ArrowDown":e=this.listNext(e);break;case"Home":e=this.listFirst();break;case"End":e=this.listLast();break;case"Escape":case"ArrowLeft":case"ArrowRight":e=this.listExit();break;default:return!1}e.setAttribute("tabindex",0),e.focus(),this.sel&&this.sel.setAttribute("tabindex",-1),this.sel=e,t.preventDefault(),t.stopPropagation()}listPrev(t){return 0!==t.parentNode.previousElementSibling.length?t.parentNode.previousElementSibling.firstElementChild:this.listLast()}listNext(t){return 0!==t.parentNode.nextElementSibling.length?t.parentNode.nextElementSibling.firstElementChild:this.listFirst()}listFirst(){return this.list.firstElementChild.firstElementChild}listLast(){return this.list.lastElementChild.firstElementChild}listExit(){return this.mouseoutHandler(),this.btn}listEnter(){return this.list.firstElementChild.firstElementChild}}document.addEventListener("DOMContentLoaded",(()=>{new e("version-popover")}))}();