

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GPU Module (gpu) &mdash; UPBGE/Blender Python API</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme_overrides_upbge.css?v=3436ad75" />

  
    <link rel="shortcut icon" href="_static/upbge_favicon.png"/>
    <link rel="canonical" href="https://upbge.org/docs/latest/api/gpu.html" />
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=0755ccff"></script>
      <script src="_static/doctools.js?v=fd6eb6e6"></script>
      <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within UPBGE/Blender Python API"
          href="_static/opensearch.xml"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="GPU Types (gpu.types)" href="gpu.types.html" />
    <link rel="prev" title="freestyle.utils submodule (freestyle.utils.ContextFunctions)" href="freestyle.utils.ContextFunctions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            UPBGE 0.5x & Blender 5.1.0 Alpha Python API
              <img src="_static/upbge_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="info_quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="info_overview.html">API Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="info_api_reference.html">API Reference Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="info_best_practice.html">Best Practice</a></li>
<li class="toctree-l1"><a class="reference internal" href="info_tips_and_tricks.html">Tips and Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="info_gotcha.html">Gotchas</a></li>
<li class="toctree-l1"><a class="reference internal" href="info_advanced.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="change_log.html">Change Log</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Application Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bpy.context.html">Context Access (bpy.context)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bpy.data.html">Data Access (bpy.data)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bpy.msgbus.html">Message Bus (bpy.msgbus)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bpy.ops.html">Operators (bpy.ops)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bpy.types.html">Types (bpy.types)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bpy.utils.html">Utilities (bpy.utils)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bpy.path.html">Path Utilities (bpy.path)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bpy.app.html">Application Data (bpy.app)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bpy.props.html">Property Definitions (bpy.props)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Game Engine Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bge.types.html">Game Types (bge.types)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bge.logic.html">Game Logic (bge.logic)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bge.render.html">Rasterizer (bge.render)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bge.texture.html">Video Texture (bge.texture)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bge.texture.html#ffmpeg-video-and-image-status">FFmpeg Video and Image Status</a></li>
<li class="toctree-l1"><a class="reference internal" href="bge.texture.html#image-blending-modes">Image Blending Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="bge.events.html">Game Keys (bge.events)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bge.constraints.html">Physics Constraints (bge.constraints)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bge.app.html">Application Data (bge.app)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bgui.html">Game GUI (bgui)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Standalone Modules</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="aud.html">Audio System (aud)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bl_math.html">Additional Math Functions (bl_math)</a></li>
<li class="toctree-l1"><a class="reference internal" href="blf.html">Font Drawing (blf)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bmesh.html">BMesh Module (bmesh)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bpy_extras.html">Extra Utilities (bpy_extras)</a></li>
<li class="toctree-l1"><a class="reference internal" href="freestyle.html">Freestyle Module (freestyle)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">GPU Module (gpu)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gpu.types.html">GPU Types (gpu.types)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu.matrix.html">GPU Matrix Utilities (gpu.matrix)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu.select.html">GPU Select Utilities (gpu.select)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu.shader.html">GPU Shader Utilities (gpu.shader)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu.state.html">GPU State Utilities (gpu.state)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu.texture.html">GPU Texture Utilities (gpu.texture)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu.platform.html">GPU Platform Utilities (gpu.platform)</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpu.capabilities.html">GPU Capabilities Utilities (gpu.capabilities)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#geometry-batches">Geometry Batches</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vertex-buffers">Vertex Buffers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#index-buffers">Index Buffers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shaders">Shaders</a></li>
<li class="toctree-l2"><a class="reference internal" href="#batch-creation">Batch Creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#offscreen-rendering">Offscreen Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#triangle-with-custom-shader">Triangle with Custom Shader</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wireframe-cube-using-index-buffer">Wireframe Cube using Index Buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mesh-with-random-vertex-colors">Mesh with Random Vertex Colors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d-rectangle">2D Rectangle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d-image">2D Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generate-a-texture-using-offscreen-rendering">Generate a texture using Offscreen Rendering</a></li>
<li class="toctree-l3"><a class="reference internal" href="#copy-off-screen-rendering-result-back-to-ram">Copy Off-screen Rendering result back to RAM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rendering-the-3d-view-into-a-texture">Rendering the 3D View into a Texture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-shader-for-dotted-3d-line">Custom Shader for dotted 3D Line</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-compute-shader-using-image-store-and-vertex-fragment-shader">Custom compute shader (using image store) and vertex/fragment shader</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gpu.GPU_BARRIER_BUFFER_UPDATE"><code class="docutils literal notranslate"><span class="pre">GPU_BARRIER_BUFFER_UPDATE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpu.GPU_BARRIER_COMMAND"><code class="docutils literal notranslate"><span class="pre">GPU_BARRIER_COMMAND</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpu.GPU_BARRIER_DEFAULT"><code class="docutils literal notranslate"><span class="pre">GPU_BARRIER_DEFAULT</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpu.GPU_BARRIER_ELEMENT_ARRAY"><code class="docutils literal notranslate"><span class="pre">GPU_BARRIER_ELEMENT_ARRAY</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpu.GPU_BARRIER_FRAMEBUFFER"><code class="docutils literal notranslate"><span class="pre">GPU_BARRIER_FRAMEBUFFER</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpu.GPU_BARRIER_SHADER_IMAGE_ACCESS"><code class="docutils literal notranslate"><span class="pre">GPU_BARRIER_SHADER_IMAGE_ACCESS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpu.GPU_BARRIER_SHADER_STORAGE"><code class="docutils literal notranslate"><span class="pre">GPU_BARRIER_SHADER_STORAGE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpu.GPU_BARRIER_TEXTURE_FETCH"><code class="docutils literal notranslate"><span class="pre">GPU_BARRIER_TEXTURE_FETCH</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpu.GPU_BARRIER_TEXTURE_UPDATE"><code class="docutils literal notranslate"><span class="pre">GPU_BARRIER_TEXTURE_UPDATE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpu.GPU_BARRIER_UNIFORM"><code class="docutils literal notranslate"><span class="pre">GPU_BARRIER_UNIFORM</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpu.GPU_BARRIER_VERTEX_ATTRIB_ARRAY"><code class="docutils literal notranslate"><span class="pre">GPU_BARRIER_VERTEX_ATTRIB_ARRAY</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gpu_extras.html">GPU Utilities (gpu_extras)</a></li>
<li class="toctree-l1"><a class="reference internal" href="idprop.html">ID Properties Module (idprop)</a></li>
<li class="toctree-l1"><a class="reference internal" href="imbuf.html">Image Buffer (imbuf)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mathutils.html">Math Types &amp; Utilities (mathutils)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">UPBGE 0.5x & Blender 5.1.0 Alpha Python API</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">GPU Module (gpu)</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-gpu">
<span id="gpu-module-gpu"></span><h1>GPU Module (gpu)<a class="headerlink" href="#module-gpu" title="Link to this heading"></a></h1>
<p>This module provides Python wrappers for the GPU implementation in Blender.
Some higher level functions can be found in the <a class="reference internal" href="gpu_extras.html#module-gpu_extras" title="gpu_extras"><code class="xref py py-mod docutils literal notranslate"><span class="pre">gpu_extras</span></code></a> module.</p>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Submodules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="gpu.types.html">GPU Types (gpu.types)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.matrix.html">GPU Matrix Utilities (gpu.matrix)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.select.html">GPU Select Utilities (gpu.select)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.shader.html">GPU Shader Utilities (gpu.shader)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.state.html">GPU State Utilities (gpu.state)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.texture.html">GPU Texture Utilities (gpu.texture)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.platform.html">GPU Platform Utilities (gpu.platform)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.capabilities.html">GPU Capabilities Utilities (gpu.capabilities)</a></li>
</ul>
</div>
<section id="geometry-batches">
<h2>Geometry Batches<a class="headerlink" href="#geometry-batches" title="Link to this heading"></a></h2>
<p>Geometry is drawn in batches.
A batch contains the necessary data to perform the drawing.
That includes an obligatory <em>Vertex Buffer</em> and an optional <em>Index Buffer</em>,
each of which is described in more detail in the following sections.
A batch also defines a draw type.
Typical draw types are <code class="docutils literal notranslate"><span class="pre">POINTS</span></code>, <code class="docutils literal notranslate"><span class="pre">LINES</span></code> and <code class="docutils literal notranslate"><span class="pre">TRIS</span></code>.
The draw type determines how the data will be interpreted and drawn.</p>
</section>
<section id="vertex-buffers">
<h2>Vertex Buffers<a class="headerlink" href="#vertex-buffers" title="Link to this heading"></a></h2>
<p>A <em>Vertex Buffer Object</em> (VBO) (<a class="reference internal" href="gpu.types.html#gpu.types.GPUVertBuf" title="gpu.types.GPUVertBuf"><code class="xref py py-class docutils literal notranslate"><span class="pre">gpu.types.GPUVertBuf</span></code></a>)
is an array that contains the vertex attributes needed for drawing using a specific shader.
Typical vertex attributes are <em>location</em>, <em>normal</em>, <em>color</em>, and <em>uv</em>.
Every vertex buffer has a <em>Vertex Format</em> (<a class="reference internal" href="gpu.types.html#gpu.types.GPUVertFormat" title="gpu.types.GPUVertFormat"><code class="xref py py-class docutils literal notranslate"><span class="pre">gpu.types.GPUVertFormat</span></code></a>)
and a length corresponding to the number of vertices in the buffer.
A vertex format describes the attributes stored per vertex and their types.</p>
<p>The following code demonstrates the creation of a vertex buffer that contains 6 vertices.
For each vertex 2 attributes will be stored: The position and the normal.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">gpu</span>
<span class="n">vertex_positions</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">...</span><span class="p">]</span>
<span class="n">vertex_normals</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="o">...</span><span class="p">]</span>

<span class="n">fmt</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUVertFormat</span><span class="p">()</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">attr_add</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;pos&quot;</span><span class="p">,</span> <span class="n">comp_type</span><span class="o">=</span><span class="s1">&#39;F32&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fetch_mode</span><span class="o">=</span><span class="s1">&#39;FLOAT&#39;</span><span class="p">)</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">attr_add</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="n">comp_type</span><span class="o">=</span><span class="s1">&#39;F32&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fetch_mode</span><span class="o">=</span><span class="s1">&#39;FLOAT&#39;</span><span class="p">)</span>

<span class="n">vbo</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUVertBuf</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
<span class="n">vbo</span><span class="o">.</span><span class="n">attr_fill</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;pos&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">vertex_positions</span><span class="p">)</span>
<span class="n">vbo</span><span class="o">.</span><span class="n">attr_fill</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">vertex_normals</span><span class="p">)</span>
</pre></div>
</div>
<p>This vertex buffer could be used to draw 6 points, 3 separate lines, 5 consecutive lines, 2 separate triangles, …
E.g. in the case of lines, each two consecutive vertices define a line.
The type that will actually be drawn is determined when the batch is created later.</p>
</section>
<section id="index-buffers">
<h2>Index Buffers<a class="headerlink" href="#index-buffers" title="Link to this heading"></a></h2>
<p>Often triangles and lines share one or more vertices.
With only a vertex buffer one would have to store all attributes for the these vertices multiple times.
This is very inefficient because in a connected triangle mesh every vertex is used 6 times on average.
A more efficient approach would be to use an <em>Index Buffer</em> (IBO) (<a class="reference internal" href="gpu.types.html#gpu.types.GPUIndexBuf" title="gpu.types.GPUIndexBuf"><code class="xref py py-class docutils literal notranslate"><span class="pre">gpu.types.GPUIndexBuf</span></code></a>),
sometimes referred to as <em>Element Buffer</em>.
An <em>Index Buffer</em> is an array that references vertices based on their index in the vertex buffer.</p>
<p>For instance, to draw a rectangle composed of two triangles, one could use an index buffer.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">positions</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

<span class="n">indices</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">ibo</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUIndexBuf</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;TRIS&#39;</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
</pre></div>
</div>
<p>Here the first tuple in <code class="docutils literal notranslate"><span class="pre">indices</span></code> describes which vertices should be used for the first triangle
(same for the second tuple).
Note how the diagonal vertices 1 and 2 are shared between both triangles.</p>
</section>
<section id="shaders">
<h2>Shaders<a class="headerlink" href="#shaders" title="Link to this heading"></a></h2>
<p>A shader is a program that runs on the GPU (written in GLSL in our case).
There are multiple types of shaders.
The most important ones are <em>Vertex Shaders</em> and <em>Fragment Shaders</em>.
Typically multiple shaders are linked together into a <em>Program</em>.
However, in the Blender Python API the term <em>Shader</em> refers to an OpenGL Program.
Every <a class="reference internal" href="gpu.types.html#gpu.types.GPUShader" title="gpu.types.GPUShader"><code class="xref py py-class docutils literal notranslate"><span class="pre">gpu.types.GPUShader</span></code></a> consists of a vertex shader, a fragment shader and an optional geometry shader.
For common drawing tasks there are some built-in shaders accessible from <a class="reference internal" href="gpu.shader.html#gpu.shader.from_builtin" title="gpu.shader.from_builtin"><code class="xref py py-class docutils literal notranslate"><span class="pre">gpu.shader.from_builtin</span></code></a>
with an identifier such as <code class="docutils literal notranslate"><span class="pre">UNIFORM_COLOR</span></code> or <code class="docutils literal notranslate"><span class="pre">FLAT_COLOR</span></code>. There are specific builtin shaders for
drawing triangles, lines and points.</p>
<p>Every shader defines a set of attributes and uniforms that have to be set in order to use the shader.
Attributes are properties that are set using a vertex buffer and can be different for individual vertices.
Uniforms are properties that are constant per draw call.
They can be set using the <code class="docutils literal notranslate"><span class="pre">shader.uniform_*</span></code> functions after the shader has been bound.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is important to note that GLSL sources are reinterpreted to MSL (Metal Shading Language)
on Apple operating systems.
This uses a small compatibility layer that does not cover the whole GLSL language specification.
Here is a list of differences to keep in mind when targeting compatibility with Apple platforms:</p>
<ul>
<li><p>The only matrix constructors available are:</p>
<blockquote>
<div><ul class="simple">
<li><p>diagonal scalar (example: <code class="docutils literal notranslate"><span class="pre">mat2(1)</span></code>)</p></li>
<li><p>all scalars (example: <code class="docutils literal notranslate"><span class="pre">mat2(1,</span> <span class="pre">0,</span> <span class="pre">0,</span> <span class="pre">1)</span></code>)</p></li>
<li><p>column vector (example: <code class="docutils literal notranslate"><span class="pre">mat2(vec2(1,0),</span> <span class="pre">vec2(0,1))</span></code>)</p></li>
<li><p>reshape constructors work only for square matrices (example: <code class="docutils literal notranslate"><span class="pre">mat3(mat4(1))</span></code>)</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vertex</span></code>, <code class="docutils literal notranslate"><span class="pre">fragment</span></code> and <code class="docutils literal notranslate"><span class="pre">kernel</span></code> are reserved keywords.</p></li>
<li><p>all types and keywords defined by the
<a class="reference external" href="https://developer.apple.com/metal/Metal-Shading-Language-Specification.pdf">MSL specification</a>
are reserved keywords and should not be used.</p></li>
</ul>
</div>
</section>
<section id="batch-creation">
<h2>Batch Creation<a class="headerlink" href="#batch-creation" title="Link to this heading"></a></h2>
<p>Batches can be creates by first manually creating VBOs and IBOs.
However, it is recommended to use the <a class="reference internal" href="gpu_extras.batch.html#gpu_extras.batch.batch_for_shader" title="gpu_extras.batch.batch_for_shader"><code class="xref py py-class docutils literal notranslate"><span class="pre">gpu_extras.batch.batch_for_shader</span></code></a> function.
It makes sure that all the vertex attributes necessary for a specific shader are provided.
Consequently, the shader has to be passed to the function as well.
When using this function one rarely has to care about the vertex format, VBOs and IBOs created in the background.
This is still something one should know when drawing stuff though.</p>
<p>Since batches can be drawn multiple times, they should be cached and reused whenever possible.</p>
</section>
<section id="offscreen-rendering">
<h2>Offscreen Rendering<a class="headerlink" href="#offscreen-rendering" title="Link to this heading"></a></h2>
<p>What one can see on the screen after rendering is called the <em>Front Buffer</em>.
When draw calls are issued, batches are drawn on a <em>Back Buffer</em> that will only be displayed
when all drawing is done and the current back buffer will become the new front buffer.
Sometimes, one might want to draw the batches into a distinct buffer that could be used as
texture to display on another object or to be saved as image on disk.
This is called Offscreen Rendering.
In Blender Offscreen Rendering is done using the <a class="reference internal" href="gpu.types.html#gpu.types.GPUOffScreen" title="gpu.types.GPUOffScreen"><code class="xref py py-class docutils literal notranslate"><span class="pre">gpu.types.GPUOffScreen</span></code></a> type.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><a class="reference internal" href="gpu.types.html#gpu.types.GPUOffScreen" title="gpu.types.GPUOffScreen"><code class="xref py py-class docutils literal notranslate"><span class="pre">gpu.types.GPUOffScreen</span></code></a> objects are bound to the OpenGL context they have been created in.
This means that once Blender discards this context (i.e. the window is closed),
the offscreen instance will be freed.</p>
</div>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h2>
<p>To try these examples, just copy them into Blenders text editor and execute them.
To keep the examples relatively small, they just register a draw function that can’t easily be removed anymore.
Blender has to be restarted in order to delete the draw handlers.</p>
<p>3D Points with Single Color</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gpu</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gpu_extras.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">batch_for_shader</span>

<span class="n">coords</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<span class="n">shader</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">shader</span><span class="o">.</span><span class="n">from_builtin</span><span class="p">(</span><span class="s1">&#39;POINT_UNIFORM_COLOR&#39;</span><span class="p">)</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">batch_for_shader</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="s1">&#39;POINTS&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;pos&quot;</span><span class="p">:</span> <span class="n">coords</span><span class="p">})</span>


<span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">():</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">gpu</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">point_size_set</span><span class="p">(</span><span class="mf">4.5</span><span class="p">)</span>
    <span class="n">batch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">shader</span><span class="p">)</span>


<span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">SpaceView3D</span><span class="o">.</span><span class="n">draw_handler_add</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="p">(),</span> <span class="s1">&#39;WINDOW&#39;</span><span class="p">,</span> <span class="s1">&#39;POST_VIEW&#39;</span><span class="p">)</span>


<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">3D Lines with Single Color</span>
<span class="sd">--------------------------</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gpu</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gpu_extras.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">batch_for_shader</span>

<span class="n">coords</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<span class="n">shader</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">shader</span><span class="o">.</span><span class="n">from_builtin</span><span class="p">(</span><span class="s1">&#39;POLYLINE_UNIFORM_COLOR&#39;</span><span class="p">)</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">batch_for_shader</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="s1">&#39;LINES&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;pos&quot;</span><span class="p">:</span> <span class="n">coords</span><span class="p">})</span>


<span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">():</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;viewportSize&quot;</span><span class="p">,</span> <span class="n">gpu</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">viewport_get</span><span class="p">()[</span><span class="mi">2</span><span class="p">:])</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;lineWidth&quot;</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">)</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">batch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">shader</span><span class="p">)</span>


<span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">SpaceView3D</span><span class="o">.</span><span class="n">draw_handler_add</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="p">(),</span> <span class="s1">&#39;WINDOW&#39;</span><span class="p">,</span> <span class="s1">&#39;POST_VIEW&#39;</span><span class="p">)</span>
</pre></div>
</div>
<section id="triangle-with-custom-shader">
<h3>Triangle with Custom Shader<a class="headerlink" href="#triangle-with-custom-shader" title="Link to this heading"></a></h3>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gpu</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gpu_extras.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">batch_for_shader</span>


<span class="n">vert_out</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUStageInterfaceInfo</span><span class="p">(</span><span class="s2">&quot;my_interface&quot;</span><span class="p">)</span>
<span class="n">vert_out</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="s1">&#39;VEC3&#39;</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">)</span>

<span class="n">shader_info</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUShaderCreateInfo</span><span class="p">()</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">push_constant</span><span class="p">(</span><span class="s1">&#39;MAT4&#39;</span><span class="p">,</span> <span class="s2">&quot;viewProjectionMatrix&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">push_constant</span><span class="p">(</span><span class="s1">&#39;FLOAT&#39;</span><span class="p">,</span> <span class="s2">&quot;brightness&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">vertex_in</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;VEC3&#39;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">vertex_out</span><span class="p">(</span><span class="n">vert_out</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">fragment_out</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;VEC4&#39;</span><span class="p">,</span> <span class="s2">&quot;FragColor&quot;</span><span class="p">)</span>

<span class="n">shader_info</span><span class="o">.</span><span class="n">vertex_source</span><span class="p">(</span>
    <span class="s2">&quot;void main()&quot;</span>
    <span class="s2">&quot;{&quot;</span>
    <span class="s2">&quot;  pos = position;&quot;</span>
    <span class="s2">&quot;  gl_Position = viewProjectionMatrix * vec4(position, 1.0f);&quot;</span>
    <span class="s2">&quot;}&quot;</span>
<span class="p">)</span>

<span class="n">shader_info</span><span class="o">.</span><span class="n">fragment_source</span><span class="p">(</span>
    <span class="s2">&quot;void main()&quot;</span>
    <span class="s2">&quot;{&quot;</span>
    <span class="s2">&quot;  FragColor = vec4(pos * brightness, 1.0);&quot;</span>
    <span class="s2">&quot;}&quot;</span>
<span class="p">)</span>

<span class="n">shader</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">shader</span><span class="o">.</span><span class="n">create_from_info</span><span class="p">(</span><span class="n">shader_info</span><span class="p">)</span>
<span class="k">del</span> <span class="n">vert_out</span>
<span class="k">del</span> <span class="n">shader_info</span>

<span class="n">coords</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">batch_for_shader</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="s1">&#39;TRIS&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">coords</span><span class="p">})</span>


<span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">():</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">region_data</span><span class="o">.</span><span class="n">perspective_matrix</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;viewProjectionMatrix&quot;</span><span class="p">,</span> <span class="n">matrix</span><span class="p">)</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;brightness&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">batch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">shader</span><span class="p">)</span>


<span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">SpaceView3D</span><span class="o">.</span><span class="n">draw_handler_add</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="p">(),</span> <span class="s1">&#39;WINDOW&#39;</span><span class="p">,</span> <span class="s1">&#39;POST_VIEW&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="wireframe-cube-using-index-buffer">
<h3>Wireframe Cube using Index Buffer<a class="headerlink" href="#wireframe-cube-using-index-buffer" title="Link to this heading"></a></h3>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gpu</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gpu_extras.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">batch_for_shader</span>

<span class="n">coords</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">))</span>

<span class="n">indices</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">shader</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">shader</span><span class="o">.</span><span class="n">from_builtin</span><span class="p">(</span><span class="s1">&#39;POLYLINE_UNIFORM_COLOR&#39;</span><span class="p">)</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">batch_for_shader</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="s1">&#39;LINES&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;pos&quot;</span><span class="p">:</span> <span class="n">coords</span><span class="p">},</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">():</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;viewportSize&quot;</span><span class="p">,</span> <span class="n">gpu</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">viewport_get</span><span class="p">()[</span><span class="mi">2</span><span class="p">:])</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;lineWidth&quot;</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">)</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">batch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">shader</span><span class="p">)</span>


<span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">SpaceView3D</span><span class="o">.</span><span class="n">draw_handler_add</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="p">(),</span> <span class="s1">&#39;WINDOW&#39;</span><span class="p">,</span> <span class="s1">&#39;POST_VIEW&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="mesh-with-random-vertex-colors">
<h3>Mesh with Random Vertex Colors<a class="headerlink" href="#mesh-with-random-vertex-colors" title="Link to this heading"></a></h3>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gpu</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gpu_extras.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">batch_for_shader</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">active_object</span><span class="o">.</span><span class="n">data</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">calc_loop_triangles</span><span class="p">()</span>

<span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">loop_triangles</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;i&#39;</span><span class="p">)</span>

<span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span>
    <span class="s2">&quot;co&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">loop_triangles</span><span class="o">.</span><span class="n">foreach_get</span><span class="p">(</span>
    <span class="s2">&quot;vertices&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">loop_triangles</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">vertex_colors</span> <span class="o">=</span> <span class="p">[(</span><span class="n">random</span><span class="p">(),</span> <span class="n">random</span><span class="p">(),</span> <span class="n">random</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">))]</span>

<span class="n">shader</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">shader</span><span class="o">.</span><span class="n">from_builtin</span><span class="p">(</span><span class="s1">&#39;SMOOTH_COLOR&#39;</span><span class="p">)</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">batch_for_shader</span><span class="p">(</span>
    <span class="n">shader</span><span class="p">,</span> <span class="s1">&#39;TRIS&#39;</span><span class="p">,</span>
    <span class="p">{</span><span class="s2">&quot;pos&quot;</span><span class="p">:</span> <span class="n">vertices</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">vertex_colors</span><span class="p">},</span>
    <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">():</span>
    <span class="n">gpu</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">depth_test_set</span><span class="p">(</span><span class="s1">&#39;LESS_EQUAL&#39;</span><span class="p">)</span>
    <span class="n">gpu</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">depth_mask_set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">batch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">shader</span><span class="p">)</span>
    <span class="n">gpu</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">depth_mask_set</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


<span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">SpaceView3D</span><span class="o">.</span><span class="n">draw_handler_add</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="p">(),</span> <span class="s1">&#39;WINDOW&#39;</span><span class="p">,</span> <span class="s1">&#39;POST_VIEW&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="d-rectangle">
<h3>2D Rectangle<a class="headerlink" href="#d-rectangle" title="Link to this heading"></a></h3>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gpu</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gpu_extras.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">batch_for_shader</span>

<span class="n">vertices</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>

<span class="n">indices</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">shader</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">shader</span><span class="o">.</span><span class="n">from_builtin</span><span class="p">(</span><span class="s1">&#39;UNIFORM_COLOR&#39;</span><span class="p">)</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">batch_for_shader</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="s1">&#39;TRIS&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;pos&quot;</span><span class="p">:</span> <span class="n">vertices</span><span class="p">},</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">():</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="n">batch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">shader</span><span class="p">)</span>


<span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">SpaceView3D</span><span class="o">.</span><span class="n">draw_handler_add</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="p">(),</span> <span class="s1">&#39;WINDOW&#39;</span><span class="p">,</span> <span class="s1">&#39;POST_PIXEL&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="d-image">
<h3>2D Image<a class="headerlink" href="#d-image" title="Link to this heading"></a></h3>
<p>To use this example you have to provide an image that should be displayed.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gpu</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gpu_extras.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">batch_for_shader</span>

<span class="n">IMAGE_NAME</span> <span class="o">=</span> <span class="s2">&quot;Untitled&quot;</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">IMAGE_NAME</span><span class="p">]</span>
<span class="n">texture</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">texture</span><span class="o">.</span><span class="n">from_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

<span class="n">shader</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">shader</span><span class="o">.</span><span class="n">from_builtin</span><span class="p">(</span><span class="s1">&#39;IMAGE_SCENE_LINEAR_TO_REC709_SRGB&#39;</span><span class="p">)</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">batch_for_shader</span><span class="p">(</span>
    <span class="n">shader</span><span class="p">,</span> <span class="s1">&#39;TRI_FAN&#39;</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s2">&quot;pos&quot;</span><span class="p">:</span> <span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)),</span>
        <span class="s2">&quot;texCoord&quot;</span><span class="p">:</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
    <span class="p">},</span>
<span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">():</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_sampler</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">texture</span><span class="p">)</span>
    <span class="n">batch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">shader</span><span class="p">)</span>


<span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">SpaceView3D</span><span class="o">.</span><span class="n">draw_handler_add</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="p">(),</span> <span class="s1">&#39;WINDOW&#39;</span><span class="p">,</span> <span class="s1">&#39;POST_PIXEL&#39;</span><span class="p">)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">3D Image</span>
<span class="sd">--------</span>

<span class="sd">Similar to the 2D Image shader, but works with 3D positions for the image vertices.</span>
<span class="sd">To use this example you have to provide an image that should be displayed.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gpu</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gpu_extras.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">batch_for_shader</span>

<span class="n">IMAGE_NAME</span> <span class="o">=</span> <span class="s2">&quot;Untitled&quot;</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">IMAGE_NAME</span><span class="p">]</span>
<span class="n">texture</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">texture</span><span class="o">.</span><span class="n">from_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

<span class="n">shader</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">shader</span><span class="o">.</span><span class="n">from_builtin</span><span class="p">(</span><span class="s1">&#39;IMAGE_SCENE_LINEAR_TO_REC709_SRGB&#39;</span><span class="p">)</span>
<span class="n">batch</span> <span class="o">=</span> <span class="n">batch_for_shader</span><span class="p">(</span>
    <span class="n">shader</span><span class="p">,</span> <span class="s1">&#39;TRIS&#39;</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s2">&quot;pos&quot;</span><span class="p">:</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
        <span class="s2">&quot;texCoord&quot;</span><span class="p">:</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
    <span class="p">},</span>
<span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">():</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_sampler</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">texture</span><span class="p">)</span>
    <span class="n">batch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">shader</span><span class="p">)</span>


<span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">SpaceView3D</span><span class="o">.</span><span class="n">draw_handler_add</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="p">(),</span> <span class="s1">&#39;WINDOW&#39;</span><span class="p">,</span> <span class="s1">&#39;POST_VIEW&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="generate-a-texture-using-offscreen-rendering">
<h3>Generate a texture using Offscreen Rendering<a class="headerlink" href="#generate-a-texture-using-offscreen-rendering" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Create an <a class="reference internal" href="gpu.types.html#gpu.types.GPUOffScreen" title="gpu.types.GPUOffScreen"><code class="xref py py-class docutils literal notranslate"><span class="pre">gpu.types.GPUOffScreen</span></code></a> object.</p></li>
<li><p>Draw some circles into it.</p></li>
<li><p>Make a new shader for drawing a planar texture in 3D.</p></li>
<li><p>Draw the generated texture using the new shader.</p></li>
</ol>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gpu</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mathutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">Matrix</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gpu_extras.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">batch_for_shader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gpu_extras.presets</span><span class="w"> </span><span class="kn">import</span> <span class="n">draw_circle_2d</span>

<span class="c1"># Create and fill offscreen</span>
<span class="c1">##########################################</span>

<span class="n">offscreen</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUOffScreen</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>

<span class="k">with</span> <span class="n">offscreen</span><span class="o">.</span><span class="n">bind</span><span class="p">():</span>
    <span class="n">fb</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">active_framebuffer_get</span><span class="p">()</span>
    <span class="n">fb</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
    <span class="k">with</span> <span class="n">gpu</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">push_pop</span><span class="p">():</span>
        <span class="c1"># Reset matrices -&gt; use normalized device coordinates [-1, 1].</span>
        <span class="n">gpu</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">load_matrix</span><span class="p">(</span><span class="n">Matrix</span><span class="o">.</span><span class="n">Identity</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">gpu</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">load_projection_matrix</span><span class="p">(</span><span class="n">Matrix</span><span class="o">.</span><span class="n">Identity</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

        <span class="n">amount</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">amount</span><span class="p">,</span> <span class="n">amount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">x_pos</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">amount</span>
            <span class="n">draw_circle_2d</span><span class="p">((</span><span class="n">x_pos</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>


<span class="c1"># Drawing the generated texture in 3D space</span>
<span class="c1">#############################################</span>

<span class="n">vert_out</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUStageInterfaceInfo</span><span class="p">(</span><span class="s2">&quot;my_interface&quot;</span><span class="p">)</span>
<span class="n">vert_out</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="s1">&#39;VEC2&#39;</span><span class="p">,</span> <span class="s2">&quot;uvInterp&quot;</span><span class="p">)</span>

<span class="n">shader_info</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUShaderCreateInfo</span><span class="p">()</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">push_constant</span><span class="p">(</span><span class="s1">&#39;MAT4&#39;</span><span class="p">,</span> <span class="s2">&quot;viewProjectionMatrix&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">push_constant</span><span class="p">(</span><span class="s1">&#39;MAT4&#39;</span><span class="p">,</span> <span class="s2">&quot;modelMatrix&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">sampler</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;FLOAT_2D&#39;</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">vertex_in</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;VEC2&#39;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">vertex_in</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;VEC2&#39;</span><span class="p">,</span> <span class="s2">&quot;uv&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">vertex_out</span><span class="p">(</span><span class="n">vert_out</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">fragment_out</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;VEC4&#39;</span><span class="p">,</span> <span class="s2">&quot;FragColor&quot;</span><span class="p">)</span>

<span class="n">shader_info</span><span class="o">.</span><span class="n">vertex_source</span><span class="p">(</span>
    <span class="s2">&quot;void main()&quot;</span>
    <span class="s2">&quot;{&quot;</span>
    <span class="s2">&quot;  uvInterp = uv;&quot;</span>
    <span class="s2">&quot;  gl_Position = viewProjectionMatrix * modelMatrix * vec4(position, 0.0, 1.0);&quot;</span>
    <span class="s2">&quot;}&quot;</span>
<span class="p">)</span>

<span class="n">shader_info</span><span class="o">.</span><span class="n">fragment_source</span><span class="p">(</span>
    <span class="s2">&quot;void main()&quot;</span>
    <span class="s2">&quot;{&quot;</span>
    <span class="s2">&quot;  FragColor = texture(image, uvInterp);&quot;</span>
    <span class="s2">&quot;}&quot;</span>
<span class="p">)</span>

<span class="n">shader</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">shader</span><span class="o">.</span><span class="n">create_from_info</span><span class="p">(</span><span class="n">shader_info</span><span class="p">)</span>
<span class="k">del</span> <span class="n">vert_out</span>
<span class="k">del</span> <span class="n">shader_info</span>

<span class="n">batch</span> <span class="o">=</span> <span class="n">batch_for_shader</span><span class="p">(</span>
    <span class="n">shader</span><span class="p">,</span> <span class="s1">&#39;TRI_FAN&#39;</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="s2">&quot;uv&quot;</span><span class="p">:</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
    <span class="p">},</span>
<span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">():</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;modelMatrix&quot;</span><span class="p">,</span> <span class="n">Matrix</span><span class="o">.</span><span class="n">Translation</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">@</span> <span class="n">Matrix</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;viewProjectionMatrix&quot;</span><span class="p">,</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">region_data</span><span class="o">.</span><span class="n">perspective_matrix</span><span class="p">)</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_sampler</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">offscreen</span><span class="o">.</span><span class="n">texture_color</span><span class="p">)</span>
    <span class="n">batch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">shader</span><span class="p">)</span>


<span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">SpaceView3D</span><span class="o">.</span><span class="n">draw_handler_add</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="p">(),</span> <span class="s1">&#39;WINDOW&#39;</span><span class="p">,</span> <span class="s1">&#39;POST_VIEW&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="copy-off-screen-rendering-result-back-to-ram">
<h3>Copy Off-screen Rendering result back to RAM<a class="headerlink" href="#copy-off-screen-rendering-result-back-to-ram" title="Link to this heading"></a></h3>
<p>This will create a new image with the given name.
If it already exists, it will override the existing one.</p>
<p>Currently almost all of the execution time is spent in the last line.
In the future this will hopefully be solved by implementing the Python buffer protocol
for <a class="reference internal" href="gpu.types.html#gpu.types.Buffer" title="gpu.types.Buffer"><code class="xref py py-class docutils literal notranslate"><span class="pre">gpu.types.Buffer</span></code></a> and <a class="reference internal" href="bpy.types.Image.html#bpy.types.Image.pixels" title="bpy.types.Image.pixels"><code class="xref py py-class docutils literal notranslate"><span class="pre">bpy.types.Image.pixels</span></code></a> (aka <code class="docutils literal notranslate"><span class="pre">bpy_prop_array</span></code>).</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gpu</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mathutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">Matrix</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gpu_extras.presets</span><span class="w"> </span><span class="kn">import</span> <span class="n">draw_circle_2d</span>

<span class="n">IMAGE_NAME</span> <span class="o">=</span> <span class="s2">&quot;Generated Image&quot;</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">512</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">512</span>
<span class="n">RING_AMOUNT</span> <span class="o">=</span> <span class="mi">10</span>


<span class="n">offscreen</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUOffScreen</span><span class="p">(</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">)</span>

<span class="k">with</span> <span class="n">offscreen</span><span class="o">.</span><span class="n">bind</span><span class="p">():</span>
    <span class="n">fb</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">active_framebuffer_get</span><span class="p">()</span>
    <span class="n">fb</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
    <span class="k">with</span> <span class="n">gpu</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">push_pop</span><span class="p">():</span>
        <span class="c1"># Reset matrices -&gt; use normalized device coordinates [-1, 1].</span>
        <span class="n">gpu</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">load_matrix</span><span class="p">(</span><span class="n">Matrix</span><span class="o">.</span><span class="n">Identity</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">gpu</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">load_projection_matrix</span><span class="p">(</span><span class="n">Matrix</span><span class="o">.</span><span class="n">Identity</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">RING_AMOUNT</span><span class="p">):</span>
            <span class="n">draw_circle_2d</span><span class="p">(</span>
                <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">segments</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="n">buffer</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">read_color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;UBYTE&#39;</span><span class="p">)</span>

<span class="n">offscreen</span><span class="o">.</span><span class="n">free</span><span class="p">()</span>


<span class="k">if</span> <span class="n">IMAGE_NAME</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">IMAGE_NAME</span><span class="p">,</span> <span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">)</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">IMAGE_NAME</span><span class="p">]</span>
<span class="n">image</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">)</span>

<span class="n">buffer</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">*</span> <span class="n">HEIGHT</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">image</span><span class="o">.</span><span class="n">pixels</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="o">/</span> <span class="mi">255</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">buffer</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="rendering-the-3d-view-into-a-texture">
<h3>Rendering the 3D View into a Texture<a class="headerlink" href="#rendering-the-3d-view-into-a-texture" title="Link to this heading"></a></h3>
<p>The scene has to have a camera for this example to work.
You could also make this independent of a specific camera,
but Blender does not expose good functions to create view and projection matrices yet.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gpu</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gpu_extras.presets</span><span class="w"> </span><span class="kn">import</span> <span class="n">draw_texture_2d</span>

<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">512</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">256</span>

<span class="n">offscreen</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUOffScreen</span><span class="p">(</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">():</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span>
    <span class="n">scene</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">scene</span>

    <span class="n">view_matrix</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">matrix_world</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span>

    <span class="n">projection_matrix</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">calc_matrix_camera</span><span class="p">(</span>
        <span class="n">context</span><span class="o">.</span><span class="n">evaluated_depsgraph_get</span><span class="p">(),</span> <span class="n">x</span><span class="o">=</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">HEIGHT</span><span class="p">)</span>

    <span class="n">offscreen</span><span class="o">.</span><span class="n">draw_view3d</span><span class="p">(</span>
        <span class="n">scene</span><span class="p">,</span>
        <span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="p">,</span>
        <span class="n">context</span><span class="o">.</span><span class="n">space_data</span><span class="p">,</span>
        <span class="n">context</span><span class="o">.</span><span class="n">region</span><span class="p">,</span>
        <span class="n">view_matrix</span><span class="p">,</span>
        <span class="n">projection_matrix</span><span class="p">,</span>
        <span class="n">do_color_management</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">gpu</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">depth_mask_set</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">draw_texture_2d</span><span class="p">(</span><span class="n">offscreen</span><span class="o">.</span><span class="n">texture_color</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">)</span>


<span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">SpaceView3D</span><span class="o">.</span><span class="n">draw_handler_add</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="p">(),</span> <span class="s1">&#39;WINDOW&#39;</span><span class="p">,</span> <span class="s1">&#39;POST_PIXEL&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="custom-shader-for-dotted-3d-line">
<h3>Custom Shader for dotted 3D Line<a class="headerlink" href="#custom-shader-for-dotted-3d-line" title="Link to this heading"></a></h3>
<p>In this example the arc length (distance to the first point on the line) is calculated in every vertex.
Between the vertex and fragment shader that value is automatically interpolated
for all points that will be visible on the screen.
In the fragment shader the <code class="docutils literal notranslate"><span class="pre">sin</span></code> of the arc length is calculated.
Based on the result a decision is made on whether the fragment should be drawn or not.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gpu</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mathutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">Vector</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gpu_extras.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">batch_for_shader</span>

<span class="n">vert_out</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUStageInterfaceInfo</span><span class="p">(</span><span class="s2">&quot;my_interface&quot;</span><span class="p">)</span>
<span class="n">vert_out</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="s1">&#39;FLOAT&#39;</span><span class="p">,</span> <span class="s2">&quot;v_ArcLength&quot;</span><span class="p">)</span>

<span class="n">shader_info</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUShaderCreateInfo</span><span class="p">()</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">push_constant</span><span class="p">(</span><span class="s1">&#39;MAT4&#39;</span><span class="p">,</span> <span class="s2">&quot;u_ViewProjectionMatrix&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">push_constant</span><span class="p">(</span><span class="s1">&#39;FLOAT&#39;</span><span class="p">,</span> <span class="s2">&quot;u_Scale&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">vertex_in</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;VEC3&#39;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">vertex_in</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;FLOAT&#39;</span><span class="p">,</span> <span class="s2">&quot;arcLength&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">vertex_out</span><span class="p">(</span><span class="n">vert_out</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">fragment_out</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;VEC4&#39;</span><span class="p">,</span> <span class="s2">&quot;FragColor&quot;</span><span class="p">)</span>

<span class="n">shader_info</span><span class="o">.</span><span class="n">vertex_source</span><span class="p">(</span>
    <span class="s2">&quot;void main()&quot;</span>
    <span class="s2">&quot;{&quot;</span>
    <span class="s2">&quot;  v_ArcLength = arcLength;&quot;</span>
    <span class="s2">&quot;  gl_Position = u_ViewProjectionMatrix * vec4(position, 1.0f);&quot;</span>
    <span class="s2">&quot;}&quot;</span>
<span class="p">)</span>

<span class="n">shader_info</span><span class="o">.</span><span class="n">fragment_source</span><span class="p">(</span>
    <span class="s2">&quot;void main()&quot;</span>
    <span class="s2">&quot;{&quot;</span>
    <span class="s2">&quot;  if (step(sin(v_ArcLength * u_Scale), 0.5) == 1) discard;&quot;</span>
    <span class="s2">&quot;  FragColor = vec4(1.0);&quot;</span>
    <span class="s2">&quot;}&quot;</span>
<span class="p">)</span>

<span class="n">shader</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">shader</span><span class="o">.</span><span class="n">create_from_info</span><span class="p">(</span><span class="n">shader_info</span><span class="p">)</span>
<span class="k">del</span> <span class="n">vert_out</span>
<span class="k">del</span> <span class="n">shader_info</span>

<span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">Vector</span><span class="p">((</span><span class="n">random</span><span class="p">(),</span> <span class="n">random</span><span class="p">(),</span> <span class="n">random</span><span class="p">()))</span> <span class="o">*</span> <span class="mi">5</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>

<span class="n">arc_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
    <span class="n">arc_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arc_lengths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>

<span class="n">batch</span> <span class="o">=</span> <span class="n">batch_for_shader</span><span class="p">(</span>
    <span class="n">shader</span><span class="p">,</span> <span class="s1">&#39;LINE_STRIP&#39;</span><span class="p">,</span>
    <span class="p">{</span><span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">coords</span><span class="p">,</span> <span class="s2">&quot;arcLength&quot;</span><span class="p">:</span> <span class="n">arc_lengths</span><span class="p">},</span>
<span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">():</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">region_data</span><span class="o">.</span><span class="n">perspective_matrix</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;u_ViewProjectionMatrix&quot;</span><span class="p">,</span> <span class="n">matrix</span><span class="p">)</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;u_Scale&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">batch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">shader</span><span class="p">)</span>


<span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">SpaceView3D</span><span class="o">.</span><span class="n">draw_handler_add</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="p">(),</span> <span class="s1">&#39;WINDOW&#39;</span><span class="p">,</span> <span class="s1">&#39;POST_VIEW&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="custom-compute-shader-using-image-store-and-vertex-fragment-shader">
<h3>Custom compute shader (using image store) and vertex/fragment shader<a class="headerlink" href="#custom-compute-shader-using-image-store-and-vertex-fragment-shader" title="Link to this heading"></a></h3>
<p>This is an example of how to use a custom compute shader
to write to a texture and then use that texture in a vertex/fragment shader.
The expected result is a 2x2 plane (size of the default cube),
which changes color from a green-black gradient to a green-red gradient,
based on current time.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gpu</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mathutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">Matrix</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gpu_extras.batch</span><span class="w"> </span><span class="kn">import</span> <span class="n">batch_for_shader</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">size</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">texture</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUTexture</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;RGBA32F&#39;</span><span class="p">)</span>

<span class="c1"># Create the compute shader to write to the texture.</span>
<span class="n">compute_shader_info</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUShaderCreateInfo</span><span class="p">()</span>
<span class="n">compute_shader_info</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;RGBA32F&#39;</span><span class="p">,</span> <span class="s2">&quot;FLOAT_2D&quot;</span><span class="p">,</span> <span class="s2">&quot;img_output&quot;</span><span class="p">,</span> <span class="n">qualifiers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;WRITE&quot;</span><span class="p">})</span>
<span class="n">compute_shader_info</span><span class="o">.</span><span class="n">compute_source</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">void main()</span>
<span class="s1">{</span>
<span class="s1">  vec4 pixel = vec4(</span>
<span class="s1">    sin(time / 1.0),</span>
<span class="s1">    gl_GlobalInvocationID.y/128.0,</span>
<span class="s1">    0.0,</span>
<span class="s1">    1.0</span>
<span class="s1">  );</span>
<span class="s1">  imageStore(img_output, ivec2(gl_GlobalInvocationID.xy), pixel);</span>
<span class="s1">}&#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">compute_shader_info</span><span class="o">.</span><span class="n">push_constant</span><span class="p">(</span><span class="s1">&#39;FLOAT&#39;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">compute_shader_info</span><span class="o">.</span><span class="n">local_group_size</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">compute_shader</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">shader</span><span class="o">.</span><span class="n">create_from_info</span><span class="p">(</span><span class="n">compute_shader_info</span><span class="p">)</span>

<span class="c1"># Create the shader to draw the texture.</span>
<span class="n">vert_out</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUStageInterfaceInfo</span><span class="p">(</span><span class="s2">&quot;my_interface&quot;</span><span class="p">)</span>
<span class="n">vert_out</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="s1">&#39;VEC2&#39;</span><span class="p">,</span> <span class="s2">&quot;uvInterp&quot;</span><span class="p">)</span>
<span class="n">shader_info</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">GPUShaderCreateInfo</span><span class="p">()</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">push_constant</span><span class="p">(</span><span class="s1">&#39;MAT4&#39;</span><span class="p">,</span> <span class="s2">&quot;viewProjectionMatrix&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">push_constant</span><span class="p">(</span><span class="s1">&#39;MAT4&#39;</span><span class="p">,</span> <span class="s2">&quot;modelMatrix&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">sampler</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;FLOAT_2D&#39;</span><span class="p">,</span> <span class="s2">&quot;img_input&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">vertex_in</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;VEC2&#39;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">vertex_in</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;VEC2&#39;</span><span class="p">,</span> <span class="s2">&quot;uv&quot;</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">vertex_out</span><span class="p">(</span><span class="n">vert_out</span><span class="p">)</span>
<span class="n">shader_info</span><span class="o">.</span><span class="n">fragment_out</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;VEC4&#39;</span><span class="p">,</span> <span class="s2">&quot;FragColor&quot;</span><span class="p">)</span>

<span class="n">shader_info</span><span class="o">.</span><span class="n">vertex_source</span><span class="p">(</span>
    <span class="s2">&quot;void main()&quot;</span>
    <span class="s2">&quot;{&quot;</span>
    <span class="s2">&quot;  uvInterp = uv;&quot;</span>
    <span class="s2">&quot;  gl_Position = viewProjectionMatrix * modelMatrix * vec4(position, 0.0, 1.0);&quot;</span>
    <span class="s2">&quot;}&quot;</span>
<span class="p">)</span>

<span class="n">shader_info</span><span class="o">.</span><span class="n">fragment_source</span><span class="p">(</span>
    <span class="s2">&quot;void main()&quot;</span>
    <span class="s2">&quot;{&quot;</span>
    <span class="s2">&quot;  FragColor = texture(img_input, uvInterp);&quot;</span>
    <span class="s2">&quot;}&quot;</span>
<span class="p">)</span>

<span class="n">shader</span> <span class="o">=</span> <span class="n">gpu</span><span class="o">.</span><span class="n">shader</span><span class="o">.</span><span class="n">create_from_info</span><span class="p">(</span><span class="n">shader_info</span><span class="p">)</span>

<span class="n">batch</span> <span class="o">=</span> <span class="n">batch_for_shader</span><span class="p">(</span>
    <span class="n">shader</span><span class="p">,</span> <span class="s1">&#39;TRI_FAN&#39;</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
        <span class="s2">&quot;uv&quot;</span><span class="p">:</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
    <span class="p">},</span>
<span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">():</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;modelMatrix&quot;</span><span class="p">,</span> <span class="n">Matrix</span><span class="o">.</span><span class="n">Translation</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">@</span> <span class="n">Matrix</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;viewProjectionMatrix&quot;</span><span class="p">,</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">region_data</span><span class="o">.</span><span class="n">perspective_matrix</span><span class="p">)</span>
    <span class="n">shader</span><span class="o">.</span><span class="n">uniform_sampler</span><span class="p">(</span><span class="s2">&quot;img_input&quot;</span><span class="p">,</span> <span class="n">texture</span><span class="p">)</span>
    <span class="n">batch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">shader</span><span class="p">)</span>
    <span class="n">compute_shader</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="s1">&#39;img_output&#39;</span><span class="p">,</span> <span class="n">texture</span><span class="p">)</span>
    <span class="n">compute_shader</span><span class="o">.</span><span class="n">uniform_float</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
    <span class="n">gpu</span><span class="o">.</span><span class="n">compute</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">compute_shader</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">drawTimer</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">areas</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">area</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;VIEW_3D&#39;</span><span class="p">:</span>
            <span class="n">area</span><span class="o">.</span><span class="n">tag_redraw</span><span class="p">()</span>
    <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">60.0</span>


<span class="n">bpy</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">timers</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">drawTimer</span><span class="p">)</span>
<span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">SpaceView3D</span><span class="o">.</span><span class="n">draw_handler_add</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="p">(),</span> <span class="s1">&#39;WINDOW&#39;</span><span class="p">,</span> <span class="s1">&#39;POST_VIEW&#39;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py data">
<dt class="sig sig-object py" id="gpu.GPU_BARRIER_BUFFER_UPDATE">
<span class="sig-prename descclassname"><span class="pre">gpu.</span></span><span class="sig-name descname"><span class="pre">GPU_BARRIER_BUFFER_UPDATE</span></span><a class="headerlink" href="#gpu.GPU_BARRIER_BUFFER_UPDATE" title="Link to this definition"></a></dt>
<dd><p>Constant value 32768</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="gpu.GPU_BARRIER_COMMAND">
<span class="sig-prename descclassname"><span class="pre">gpu.</span></span><span class="sig-name descname"><span class="pre">GPU_BARRIER_COMMAND</span></span><a class="headerlink" href="#gpu.GPU_BARRIER_COMMAND" title="Link to this definition"></a></dt>
<dd><p>Constant value 1024</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="gpu.GPU_BARRIER_DEFAULT">
<span class="sig-prename descclassname"><span class="pre">gpu.</span></span><span class="sig-name descname"><span class="pre">GPU_BARRIER_DEFAULT</span></span><a class="headerlink" href="#gpu.GPU_BARRIER_DEFAULT" title="Link to this definition"></a></dt>
<dd><p>Constant value 6</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="gpu.GPU_BARRIER_ELEMENT_ARRAY">
<span class="sig-prename descclassname"><span class="pre">gpu.</span></span><span class="sig-name descname"><span class="pre">GPU_BARRIER_ELEMENT_ARRAY</span></span><a class="headerlink" href="#gpu.GPU_BARRIER_ELEMENT_ARRAY" title="Link to this definition"></a></dt>
<dd><p>Constant value 8192</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="gpu.GPU_BARRIER_FRAMEBUFFER">
<span class="sig-prename descclassname"><span class="pre">gpu.</span></span><span class="sig-name descname"><span class="pre">GPU_BARRIER_FRAMEBUFFER</span></span><a class="headerlink" href="#gpu.GPU_BARRIER_FRAMEBUFFER" title="Link to this definition"></a></dt>
<dd><p>Constant value 1</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="gpu.GPU_BARRIER_SHADER_IMAGE_ACCESS">
<span class="sig-prename descclassname"><span class="pre">gpu.</span></span><span class="sig-name descname"><span class="pre">GPU_BARRIER_SHADER_IMAGE_ACCESS</span></span><a class="headerlink" href="#gpu.GPU_BARRIER_SHADER_IMAGE_ACCESS" title="Link to this definition"></a></dt>
<dd><p>Constant value 2</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="gpu.GPU_BARRIER_SHADER_STORAGE">
<span class="sig-prename descclassname"><span class="pre">gpu.</span></span><span class="sig-name descname"><span class="pre">GPU_BARRIER_SHADER_STORAGE</span></span><a class="headerlink" href="#gpu.GPU_BARRIER_SHADER_STORAGE" title="Link to this definition"></a></dt>
<dd><p>Constant value 2048</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="gpu.GPU_BARRIER_TEXTURE_FETCH">
<span class="sig-prename descclassname"><span class="pre">gpu.</span></span><span class="sig-name descname"><span class="pre">GPU_BARRIER_TEXTURE_FETCH</span></span><a class="headerlink" href="#gpu.GPU_BARRIER_TEXTURE_FETCH" title="Link to this definition"></a></dt>
<dd><p>Constant value 4</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="gpu.GPU_BARRIER_TEXTURE_UPDATE">
<span class="sig-prename descclassname"><span class="pre">gpu.</span></span><span class="sig-name descname"><span class="pre">GPU_BARRIER_TEXTURE_UPDATE</span></span><a class="headerlink" href="#gpu.GPU_BARRIER_TEXTURE_UPDATE" title="Link to this definition"></a></dt>
<dd><p>Constant value 8</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="gpu.GPU_BARRIER_UNIFORM">
<span class="sig-prename descclassname"><span class="pre">gpu.</span></span><span class="sig-name descname"><span class="pre">GPU_BARRIER_UNIFORM</span></span><a class="headerlink" href="#gpu.GPU_BARRIER_UNIFORM" title="Link to this definition"></a></dt>
<dd><p>Constant value 16384</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="gpu.GPU_BARRIER_VERTEX_ATTRIB_ARRAY">
<span class="sig-prename descclassname"><span class="pre">gpu.</span></span><span class="sig-name descname"><span class="pre">GPU_BARRIER_VERTEX_ATTRIB_ARRAY</span></span><a class="headerlink" href="#gpu.GPU_BARRIER_VERTEX_ATTRIB_ARRAY" title="Link to this definition"></a></dt>
<dd><p>Constant value 4096</p>
</dd></dl>

</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="freestyle.utils.ContextFunctions.html" class="btn btn-neutral float-left" title="freestyle.utils submodule (freestyle.utils.ContextFunctions)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="gpu.types.html" class="btn btn-neutral float-right" title="GPU Types (gpu.types)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright UPBGE &amp; Blender Authors.
      <span class="commit">Revision <code><a href=https://projects.blender.org/blender/blender/commit/93a935a00ead>93a935a00ead</a> - 31/01/2026</code>.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 
<div class="footer-contribute">
  <ul>
    <li>
      <a href="https://projects.blender.org/blender/blender/issues/new?template=.gitea/issue_template/api_docs.yaml&field:body=%2A%2APage+Information%2A%2A%0D%0AFile%3A+%60gpu.rst%60%0D%0ABlender+Version%3A+%605.1%60%0D%0A%5BPermanent+Link%5D%28https%3A%2F%2Fdocs.blender.org%2Fapi%2F5.1%2Fgpu.html%29%0D%0A%0D%0A%2A%2AShort+description+of+error%2A%2A%0D%0A%5BPlease+fill+out+a+short+description+of+the+error+here%5D%0D%0A" class="fa fa-bug"> Report issue
        on this page</a>
    </li>
  </ul>
</div>

</body>
</html>